var handlebars=handlebars||Handlebars;let a=function(){function a(a){var b=0;return a.forEach(a=>{b+=a.price}),b}function c(a,b){for(var c=a.length,d=0;d<c;d+=1){var e=$(a[d]);e.html().toLowerCase().indexOf(b.toLowerCase())<0?e.parent().parent().parent().addClass("filter"):e.parent().parent().parent().removeClass("filter")}}function e(a,b){return"hot"===b&&a.sort(function(a,b){return a.orders<b.orders?1:b.orders<a.orders?-1:0}),"price"===b&&a.sort(function(a,b){return a.price>b.price?1:b.price>a.price?-1:0}),"new"===b&&a.sort(function(a,b){return a.addDate<b.addDate?1:b.addDate<a.addDate?-1:0}),a}function f(){var a=[];b.products().then(b=>{return a=b,d.get("highlights")}).then(b=>{let c=handlebars.compile(b),d=c(a.result);$(".highlight-container").html(d)})}function g(){var a;b.isLoggedIn().then(a=>{if(a)return $(document.body).addClass("logged-in"),$(".visible-when-not-logged-in").hide(),$(".hidden-when-not-logged-in").show(),void(window.location="#/home")}),b.products().then(b=>{return a=b.result,d.get("home")}).then(b=>{let c=handlebars.compile(b),d=c(a);$("#main").html(d),n("hot","#hot"),n("new","#new")}),f()}function h(){var a=[];b.products().then(a=>{return d.get("store")}).then(b=>{let d=handlebars.compile(b),e=d(a);$("#main").html(e),$("#search").on("input",function(){var a=$(".product-name"),b=$("#search").val();c(a,b)})}),f()}function k(a){var c=[];h(),b.products().then(b=>{for(let f in b.result)c=c.concat(b.result[f]);return e(c,a),d.get("productsList")}).then(b=>{let d=handlebars.compile(b),e=d(c);$("#store").html(e),$("#sort").val(a),$("#sort").on("change",function(){var a=$("#sort").val();k(a)})})}function l(){k("hot")}function m(){k("new")}function n(a,c){var f=[];b.products().then(b=>{for(let c in b.result)f=f.concat(b.result[c]);return e(f,a),f.splice(4,f.length-4),d.get("products")}).then(a=>{let b=handlebars.compile(a),d=b(f);$(c).html(d)})}function o(a,c){var f=[],g=0,j=a.category;h(),b.bouquets().then(a=>{for(i in a.result)a.result[i].category===j&&(f[g]=a.result[i],g++);return e(f,c),d.get("productsList")}).then(b=>{let d=handlebars.compile(b),e=d(f);$("#store").html(e),$("#sort").val(c),$("#sort").on("change",function(){var b=$("#sort").val();o(a,b)})})}function p(a){var c;h(),b.bouquets().then(b=>{return c=b,e(c.result,a),d.get("productsList")}).then(b=>{let d=handlebars.compile(b),e=d(c.result);$("#store").html(e),$("#sort").val(a),$("#sort").on("change",function(){var a=$("#sort").val();p(a)})})}function q(a){var c;h(),b.boxes().then(b=>{return c=b,e(c.result,a),d.get("productsList")}).then(b=>{let d=handlebars.compile(b),e=d(c.result);$("#store").html(e),$("#sort").val(a),$("#sort").on("change",function(){var a=$("#sort").val();q(a)})})}function r(a){var c;h(),b.plants().then(b=>{return c=b,e(c.result,a),d.get("productsList")}).then(b=>{let d=handlebars.compile(b),e=d(c.result);$("#store").html(e),$("#sort").val(a),$("#sort").on("change",function(){var a=$("#sort").val();r(a)})})}function s(a){var c;h(),b.chocolates().then(b=>{return c=b,e(c.result,a),d.get("productsList")}).then(b=>{let d=handlebars.compile(b),e=d(c.result);$("#store").html(e),$("#sort").val(a),$("#sort").on("change",function(){var a=$("#sort").val();s(a)})})}function t(a){var c,e=a.id;h(),b.products().then(a=>{for(i in a.result)for(j in a.result[i])a.result[i][j].id===Number(e)&&(c=a.result[i][j]);return d.get("singleProduct")}).then(a=>{let d=handlebars.compile(a),e=d(c);$("#store").html(e),$("#btn-add-item").on("click",function(){b.addToCart(c).then(function(){})})})}function u(){d.get("shoppingCart").then(function(c){var d=Handlebars.compile(c);b.cart().then(function(c){var e=0;c?e=a(c):(e=0,c=[]),e=parseFloat(e.toString()).toFixed(2),$("#main").html(d(c)),$("#totalPrice").html("$"+e),$(".btn-remove-item").on("click",function(a){var c=$(a.target).parents("tr"),d=c.attr("data-id");b.removeFromCart(d).then(a=>{c.remove()}),u()})}),$("#btn-add-details").on("click",function(a){window.location="#/addDeliveryDetails"})})}function v(){d.get("addDeliveryDetails").then(function(a){var b=Handlebars.compile(a);$("#main").html(b)})}function w(){d.get("orderAccepted").then(function(a){var b=Handlebars.compile(a);$("#main").html(b),localStorage.removeItem("cart")})}function x(){b.isLoggedIn().then(a=>{return a?($(document.body).addClass("logged-in"),$(".visible-when-not-logged-in").hide(),$(".hidden-when-not-logged-in").show(),void(window.location="#/home")):void d.get("login").then(a=>{let c=handlebars.compile(a),d=c();$("#main").html(d),$("#btn-login").on("click",a=>{let c={username:$("#tb-username").val(),passHash:$("#tb-password").val()};return b.login(c).then(a=>{$(document.body).addClass("logged-in"),$(".visible-when-not-logged-in").hide(),$(".hidden-when-not-logged-in").show(),document.location="#/home"}),a.preventDefault(),!1}),$("#btn-register").on("click",a=>{let c={username:$("#tb-username").val(),passHash:$("#tb-password").val()};return b.register(c).then(a=>{return b.login(c)}).then(a=>{$(document.body).addClass("logged-in"),$(".visible-when-not-logged-in").hide(),$(".hidden-when-not-logged-in").show(),document.location="#/home"}),a.preventDefault(),!1})})})}function y(){b.logout().then(()=>{$(document.body).removeClass("logged-in"),$(".visible-when-not-logged-in").show(),$(".hidden-when-not-logged-in").hide()})}return{home:g,login:x,logout:y,highlights:f,products:k,newProducts:m,hotProducts:l,bouquets:p,bouquetsCategory:o,boxes:q,plants:r,chocolates:s,singleProduct:t,showCart:u,addDeliveryDetails:v,orderAccepted:w}}(),b={products(){return c.getJSON("/api/products")},bouquets(){return c.getJSON("/api/products/bouquets")},boxes(){return c.getJSON("/api/products/boxes")},plants(){return c.getJSON("/api/products/plants")},chocolates(){return c.getJSON("/api/products/chocolates")},cart(){return Promise.resolve().then(()=>{if(localStorage.getItem("username"))return JSON.parse(localStorage.getItem("cart"))})},login(a){return c.putJSON("/api/auth",a).then(a=>{localStorage.setItem("username",a.result.username),localStorage.setItem("authKey",a.result.authKey)})},register(a){return c.postJSON("/api/users",a)},logout(){return Promise.resolve().then(()=>{localStorage.removeItem("username"),localStorage.removeItem("authKey"),localStorage.removeItem("cart")})},isLoggedIn(){return Promise.resolve().then(()=>{return!!localStorage.getItem("username")})},addToCart(a){return Promise.resolve().then(()=>{let b=JSON.parse(localStorage.getItem("cart"));b||(b=[]),b.push(a),localStorage.setItem("cart",JSON.stringify(b))})},removeFromCart(a){return Promise.resolve().then(()=>{let b=JSON.parse(localStorage.getItem("cart"));if(1===b.length)localStorage.removeItem("cart");else{for(i in b)b[i].id===Number(a)&&b.splice(i,1);localStorage.setItem("cart",JSON.stringify(b))}})}},c={get:a=>{let b=new Promise((b,c)=>{$.ajax({url:a,method:"GET",success(a){b(a)}})});return b},putJSON:(a,b,c={})=>{let d=new Promise((d,e)=>{var f=c.headers||{};$.ajax({url:a,headers:f,method:"PUT",contentType:"application/json",data:JSON.stringify(b),success:a=>{d(a)}})});return d},postJSON:(a,b)=>{let c=new Promise((c,d)=>{$.ajax({url:a,method:"POST",contentType:"application/json",data:JSON.stringify(b),success:a=>{c(a)}})});return c},getJSON:a=>{let b=new Promise((b,c)=>{$.ajax({url:a,method:"GET",contentType:"application/json",success:a=>{b(a)}})});return b}},d={get:function(a){let b=`./scripts/templates/${a}.handlebars`;return c.get(b)}},e=new Navigo(null,!1);e.on("#/login",a.login).on("#/products",a.products).on("#/products/best",a.hotProducts).on("#/products/new",a.newProducts).on("#/products/boxes",a.boxes).on("#/products/plants",a.plants).on("#/products/chocolates",a.chocolates).on("#/products/bouquets",a.bouquets).on("#/products/:category",a.bouquetsCategory).on("#/products/:category/:id",a.singleProduct).on("#/shoppingCart",a.showCart).on("#/addDeliveryDetails",a.addDeliveryDetails).on("#/orderAccepted",a.orderAccepted).on("#/home",a.home).on(()=>{e.navigate("#/home")}).resolve(),$(".btn-nav-logout").click(()=>{a.logout()}),$(".menu").on("click","li",a=>{let b=$(a.target);b.parents("nav").find("li").removeClass("active"),b.parents("li").addClass("active")}),$("#cart").on("click",function(){window.location="#/shoppingCart"});